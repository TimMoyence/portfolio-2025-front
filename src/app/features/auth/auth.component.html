<section class="px-[5%]">
  <div class="relative flex flex-col overflow-auto">
    <div class="mx-auto w-full max-w-sm">
      <div dir="ltr" data-orientation="horizontal" data-slot="tabs" class="flex flex-col justify-start">
        <div role="tablist" aria-orientation="horizontal" data-slot="tabs-list"
          class="mb-8 scrollbar-none flex w-full items-center overflow-auto md:justify-center md:overflow-hidden"
          tabindex="-1" data-orientation="horizontal">
          <button type="button" role="tab" id="auth-trigger-sign-up" [attr.aria-controls]="'auth-tab-sign-up'"
            [attr.aria-selected]="isTabActive('sign-up')"
            [attr.data-state]="isTabActive('sign-up') ? 'active' : 'inactive'"
            [attr.tabindex]="isTabActive('sign-up') ? 0 : -1" data-slot="tabs-trigger" class="
              inline-flex w-1/2 items-center justify-center
              rounded-none
              border-x-0 border-t-0
              border-b-2 border-b-transparent
              px-6 py-3
              text-center text-scheme-text
              focus-visible:outline-none
              data-[state=active]:border-b-scheme-accent
              data-[state=inactive]:border-b-transparent
            " (click)="selectTab('sign-up')">
            S'inscrire
          </button>

          <button type="button" role="tab" id="auth-trigger-log-in" [attr.aria-controls]="'auth-tab-log-in'"
            [attr.aria-selected]="isTabActive('log-in')"
            [attr.data-state]="isTabActive('log-in') ? 'active' : 'inactive'"
            [attr.tabindex]="isTabActive('log-in') ? 0 : -1" data-slot="tabs-trigger" class="
              inline-flex w-1/2 items-center justify-center
              rounded-none               
              border-x-0 border-t-0      
              border-b-2 border-b-transparent
              px-6 py-3
              text-center text-scheme-text
              focus-visible:outline-none
              data-[state=active]:border-b-scheme-accent
              data-[state=inactive]:border-b-transparent
            " (click)="selectTab('log-in')">
            Connexion
          </button>
        </div>
        <div *ngIf="isTabActive('sign-up')" role="tabpanel" id="auth-tab-sign-up"
          [attr.aria-labelledby]="'auth-trigger-sign-up'" data-slot="tabs-content"
          class="focus-visible:outline-none data-[state=active]:animate-tabs"
          [attr.data-state]="isTabActive('sign-up') ? 'active' : 'inactive'" tabindex="0">
          <div class="mb-6 text-center md:mb-8">
            <h1 class="mb-5 text-h2 font-bold md:mb-6">Votre parcours</h1>
            <p class="text-medium">
              Déverrouillez votre potentiel avec un compte personnalisé
            </p>
          </div>
          <form class="grid grid-cols-1 gap-6" #signupFormRef="ngForm" (ngSubmit)="handleSignupSubmit(signupFormRef)">

            @for (field of signupFields; track field.key) {
            <div class="relative mb-6">

              <input [type]="field.type" [id]="field.key" [name]="field.key" [(ngModel)]="signupForm[field.key]"
                [required]="field.required" [minlength]="field.key === 'password' ? 8 : null"
                [email]="field.type === 'email' ? '' : false" placeholder=" " class="peer block w-full rounded-form border border-scheme-border px-3 py-2 focus:border-scheme-accent
              focus:outline-none" #control="ngModel"
                [class.border-red-500]="control.invalid && (control.touched || isSignupSubmitted)" />

              <label [for]="field.key" class="absolute left-3 tosp-2 px-1 
             bg-white text-gray-600 text-sm font-medium
             pointer-events-none transition-all duration-200
             peer-placeholder-shown:top-2
             peer-placeholder-shown:text-base
             peer-placeholder-shown:text-gray-500
             peer-focus:-top-3
             peer-focus:text-sm
             peer-focus:text-scheme-accent" [ngClass]="signupForm[field.key] 
        ? '-top-3 text-xs text-scheme-accent' 
        : 'top-2 text-sm text-gray-500'"
                [class.text-red-500]="control.invalid && (control.touched || isSignupSubmitted)">
                {{ field.label }}
                <span *ngIf="!field.required">(facultatif)</span>
              </label>
              <p *ngIf="control.invalid && (control.touched || isSignupSubmitted)" class="mt-1 text-xs text-red-500">
                @if (control.errors?.['required']) {
                Ce champ est obligatoire.
                } @else if (control.errors?.['email']) {
                Merci d’entrer une adresse email valide.
                } @else if (control.errors?.['minlength'] && field.key === 'password') {
                Le mot de passe doit contenir au moins 8 caractères.
                } @else {
                Valeur invalide.
                }
              </p>
            </div>
            }
            <div class="grid grid-cols-1 gap-4">
              <button type="submit" data-slot="button"
                class="bg-scheme-accent inline-flex items-center justify-center gap-3 rounded-button border border-scheme-border bg-neutral-darkest px-6 py-3 text-white transition-all duration-200 ease-in-out disabled:cursor-not-allowed disabled:opacity-60"
                title="Créer compte" [disabled]="isSignupLoading" [attr.aria-busy]="isSignupLoading">
                <ng-container *ngIf="!isSignupLoading; else signupLoading">
                  Créer compte
                </ng-container>
              </button>
              <ng-template #signupLoading>
                <span>Création en cours...</span>
              </ng-template>
              <p *ngIf="signupErrorMessage" class="text-sm text-red-500">
                {{ signupErrorMessage }}
              </p>
              <p *ngIf="signupSuccessMessage" class="text-sm text-green-600">
                {{ signupSuccessMessage }}
              </p>
              <button type="button" data-slot="button"
                class="inline-flex items-center justify-center gap-3 rounded-button border border-scheme-border px-6 py-3 text-scheme-text transition-all duration-200 ease-in-out"
                title="Inscrivez-vous avec Google" (click)="handleGoogleAuth('sign-up')">
                <app-svg-icon name="google" class="size-6 text-scheme-text" [size]="1.5"></app-svg-icon>
                Inscrivez-vous avec Google
              </button>
            </div>
          </form>
        </div>
        <div *ngIf="isTabActive('log-in')" role="tabpanel" id="auth-tab-log-in"
          [attr.aria-labelledby]="'auth-trigger-log-in'" data-slot="tabs-content"
          class="focus-visible:outline-none data-[state=active]:animate-tabs"
          [attr.data-state]="isTabActive('log-in') ? 'active' : 'inactive'" tabindex="0">
          <div class="mb-6 text-center md:mb-8">
            <h1 class="mb-5 text-h2 font-bold md:mb-6">Se connecter</h1>
            <p class="text-medium">
              Votre espace de croissance commence
            </p>
          </div>
          <form class="grid grid-cols-1 gap-6" #loginFormRef="ngForm" (ngSubmit)="handleLoginSubmit(loginFormRef)">
            @for (field of loginFields; track field.key) {
            <div class="relative mb-6">

              <input [type]="field.type" [id]="field.key" [name]="field.key" [(ngModel)]="loginForm[field.key]"
                [required]="field.required" [minlength]="field.key === 'password' ? 8 : null"
                [email]="field.type === 'email' ? '' : false" placeholder=" " class="peer block w-full rounded-form border border-scheme-border px-3 py-2 focus:border-scheme-accent
                          focus:outline-none" #control="ngModel"
                [class.border-red-500]="control.invalid && (control.touched || isLoginSubmitted)" />

              <label [for]="field.key" class="absolute left-3 tosp-2 px-1 
                         bg-white text-gray-600 text-sm font-medium
                         pointer-events-none transition-all duration-200
                         peer-placeholder-shown:top-2
                         peer-placeholder-shown:text-base
                         peer-placeholder-shown:text-gray-500
                         peer-focus:-top-3
                         peer-focus:text-sm
                         peer-focus:text-scheme-accent" [ngClass]="loginForm[field.key] 
                    ? '-top-3 text-xs text-scheme-accent' 
                    : 'top-2 text-sm text-gray-500'"
                [class.text-red-500]="control.invalid && (control.touched || isLoginSubmitted)">
                {{ field.label }}
                <span *ngIf="!field.required">(facultatif)</span>
              </label>
              <p *ngIf="control.invalid && (control.touched || isLoginSubmitted)" class="mt-1 text-xs text-red-500">
                @if (control.errors?.['required']) {
                Ce champ est obligatoire.
                } @else if (control.errors?.['email']) {
                Merci d’entrer une adresse email valide.
                } @else {
                Valeur invalide.
                }
              </p>
            </div>
            }
            <div class="grid grid-cols-1 gap-4">
              <button type="submit" data-slot="button"
                class="bg-scheme-accent inline-flex items-center justify-center gap-3 rounded-button border border-scheme-border bg-neutral-darkest px-6 py-3 text-white transition-all duration-200 ease-in-out disabled:cursor-not-allowed disabled:opacity-60"
                title="Log in" [disabled]="isLoginLoading" [attr.aria-busy]="isLoginLoading">
                <ng-container *ngIf="!isLoginLoading; else loginLoading">
                  Log in
                </ng-container>
              </button>
              <ng-template #loginLoading>
                <span>Connexion en cours...</span>
              </ng-template>
              <p *ngIf="loginErrorMessage" class="text-sm text-red-500">
                {{ loginErrorMessage }}
              </p>
              <p *ngIf="loginSuccessMessage" class="text-sm text-green-600">
                {{ loginSuccessMessage }}
              </p>
              <button type="button" data-slot="button"
                class="inline-flex items-center justify-center gap-3 rounded-button border border-scheme-border px-6 py-3 text-scheme-text transition-all duration-200 ease-in-out"
                title="Connectez-vous avec Google" (click)="handleGoogleAuth('log-in')">
                <app-svg-icon name="google" class="size-6 text-scheme-text" [size]="1.5"></app-svg-icon>
                Connectez-vous avec Google
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<app-contact
  subtitle="Nous sommes là pour vous aider à résoudre rapidement tous vos problèmes de connexion ou de compte.">
</app-contact>