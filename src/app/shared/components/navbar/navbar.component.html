<nav class="fixed top-0 left-0 right-0 z-50 pt-4 px-6 transition-all duration-300" [ngClass]="
            scrolled
              ? 'bg-transparent backdrop-blur-sm'
              : 'bg-scheme-background'
          " role="navigation" aria-label="Navigation principale"
  i18n-aria-label="navbar.landmark|Main navigation landmark@@navLandmark">
  <div
    class="glass-card-dark bg-scheme-background  flex items-center justify-between p-3 px-6 rounded-full max-w-7xl mx-auto transition-all duration-300"
    [ngClass]="{ 'shadow-lg': scrolled }">
    <div class=" font-bold text-xl">
      <a routerLink="/" class="flex items-center gap-2" (click)="isMobile && (mobileMenuOpen = false)">
        <span class="text-2xl" i18n="navbar.brand|Site brand name in navbar@@navBrand">Portfolio</span>
      </a>
    </div>

    <div class="hidden lg:flex items-center gap-5">
      <ng-container *ngTemplateOutlet="navContent; context: { isMobile: false }">
      </ng-container>
    </div>

    <button [attr.aria-expanded]="mobileMenuOpen" (click)="openMobileMenu()" #burgerButton type="button"
      class="lg:hidden focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 rounded-full p-2"
      aria-haspopup="dialog" aria-controls="mobile-nav"
      [attr.aria-label]="mobileMenuOpen ? closeMenuLabel : openMenuLabel">
      @if (mobileMenuOpen) {
      <app-svg-icon [ariaLabel]="closeMenuIconLabel" name="close" [size]="1.7"></app-svg-icon>
      } @else {
      <app-svg-icon [ariaLabel]="openMenuIconLabel" name="burger-menu" [size]="1.7"></app-svg-icon>
      }
    </button>
  </div>

</nav>
@if (mobileMenuOpen) {
<div id="mobile-nav" class="lg:hidden fixed inset-0 z-40" role="dialog" aria-modal="true"
  aria-labelledby="mobile-nav-label">
  <button type="button" class="absolute inset-0 bg-black/40 backdrop-blur-sm mobile-menu-backdrop"
    [attr.aria-label]="closeMenuLabel" (click)="closeMobileMenu()"></button>

  <div class="absolute top-[15%] w-full flex justify-center px-4 mobile-menu-panel">

    <div #mobileMenuPanel
      class="glass-card-dark rounded-2xl mt-2 py-3 px-4 w-80 border border-scheme-border bg-scheme-background">
      <h2 id="mobile-nav-label" class="sr-only">{{ mobileNavHeading }}</h2>
      <div class="mt-3 flex flex-col gap-4 justify-center items-center">
        <ng-container *ngTemplateOutlet="navContent; context: { isMobile: true }"></ng-container>
      </div>
    </div>
  </div>
</div>
}


<!-- SHARED NAV CONTENT -->
<ng-template #navContent let-isMobile="isMobile">
  <ul class="flex flex-col lg:flex-row items-center gap-5" [ngClass]="isMobile ? 'mt-2' : 'flex-row'">
    @for (item of navLinks; track $index) {
    <li>
      <a [routerLink]="item.href" routerLinkActive="font-medium" #rla="routerLinkActive"
        [attr.aria-current]="rla.isActive ? 'page' : null" [id]="item.label + $index"
        class="transition-colors duration-300 hover:text-scheme-accent focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2"
        (click)="isMobile && closeMobileMenu()">
        {{ item.label }}
      </a>
    </li>
    }

    @for (dropdown of dropdownSections(); track $index) {
    <li class="relative"
      (mouseenter)="!isMobile && currentlyHovered.set(dropdown.label); openDropdownMenuAndToggleInMobile(dropdown.label)"
      (mouseleave)="!isMobile && currentlyHovered.set(null); closeOnDesktopDropdownMenu(dropdown.label)">
      <button type="button"
        class="flex w-full items-center justify-center text-left text-regular gap-1 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2"
        [attr.aria-expanded]="dropdown.isOpen" aria-haspopup="true" [attr.aria-controls]="'nav-section-' + $index"
        [attr.data-dropdown-trigger]="dropdown.label" (click)="openDropdownMenuAndToggleInMobile(dropdown.label)">
        {{ dropdown.label }}
        <app-svg-icon name="chevron-down" [size]="1.7" [ariaLabel]="dropdownChevronLabel"></app-svg-icon>
      </button>

      @if (dropdown.isOpen) {
      <div [id]="'nav-section-' + $index"
        class="z-50 overflow-hidden rounded-card border border-scheme-border bg-scheme-background text-scheme-text"
        [attr.data-dropdown-panel]="dropdown.label" [ngClass]="
              isMobile
                ? 'mt-1 w-60 p-4'
                : 'mt-4 md:absolute lg:w-80 lg:p-6'
            ">
        <ul class="grid grid-cols-1 gap-y-2 py-3 lg:gap-y-4 lg:py-0">
          @for (items of dropdown.items; track $index) {
          <li>
            <a [routerLink]="items.href"
              class="grid auto-cols-fr grid-cols-[max-content_1fr] items-start gap-x-3 py-2 lg:py-1 hover:text-scheme-accent focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2"
              (click)="isMobile && closeMobileMenu()">
              <div class="flex flex-col items-center justify-center">
                <app-svg-icon [name]="items.icon" [size]="1.5"
                  [aria-label]="getIconAriaLabel(items.title)"></app-svg-icon>
              </div>
              <div class="flex flex-col items-start justify-center">
                <p class="text-regular font-semibold">{{ items.title }}</p>
                <p class="text-small block">
                  {{ items.description }}
                </p>
              </div>
            </a>
          </li>
          }
        </ul>
      </div>
      }
    </li>
    }
  </ul>

  <div class="flex items-center justify-center gap-5" [ngClass]="isMobile ? 'mt-4' : ''">
    <button type="button"
      class="bg-scheme-background rounded-button whitespace-nowrap transition-all duration-200 ease-in-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-scheme-border text-scheme-text px-5 py-2"
      title="Demander un devis" i18n-title="navbar.link.offer|Navbar primary link@@navLinkOffer:Offres"
      [routerLink]="'/offer'" (click)="isMobile && closeMobileMenu()">
      <span i18n="navbar.link.offer|Navbar primary link@@navLinkOffer:Offres">Offres</span>
    </button>

    <button type="button"
      class="bg-scheme-accent rounded-button whitespace-nowrap transition-all duration-200 ease-in-out focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-scheme-border px-5 py-2 text-white"
      title="Me contacter" i18n-title="navbar.cta.contact.title|Contact CTA tooltip@@navCtaContactTitle"
      [routerLink]="'/contact'" (click)="isMobile && closeMobileMenu()">
      <span i18n="navbar.cta.contact.label|Contact CTA label@@navCtaContactLabel">Contact</span>
    </button>
  </div>
</ng-template>